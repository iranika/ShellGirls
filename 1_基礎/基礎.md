# 目次
1. シェルとは
    1. sh
    1. PowerShell
1. シェルの基本機能とスクリプトの制御構文
1. シェルスクリプトの保守性？

# シェルとは

シェルという言葉は非常に概念的で曖昧なので広義のシェルについては説明を他の人に譲ります。

本書でのシェルはコマンドラインシェルの中でもOSシェルと呼ばれるものを指します。
OSシェルををざっくり説明するとOSとユーザを繋ぐためのインタフェースを提供するソフトウェアです。
shやPowerShellはCUI(Character User Interface)によってOSとユーザを繋ぐ役割を担っています。

シェルがユーザにシェルのインタフェースだけを提供するというのは、ユーザが利用者であるということに注視すると整理しやすいです。
ユーザの主な目的はコンピューティングリソースを利用して「〇〇がしたい」といった要求を実現することです。
要求を解決するには、機能が必要になります。
ユーザの要求はOSが提供する機能(API)を組み合わせることで実現可能ですが、OS本来の役割はハードウェア抽象化、リソースの管理、リソースの効率的な割当です。
OSは自身の提供するAPIをユーザフレンドリにラップするだけの機能なんて本来は担いたくないのです。

そこでシェルの登場です。
シェルはOSのAPIを組み合わせたユーザフレンドリなインタフェースを提供します。
こうして、OSは本来の役割に専念でき、ユーザは便利なインターフェースによって要求を実現しやすくなりました。

//ここにシェルのイメージを差し込む

余談ですが、シェルはIT企業の営業みたいなものだと過去にふと思ったことがあります。
ユーザである客はざっくりとした要求をしてきます。
ですがエンジニアは詳細な機能レベルでしか話がしたくないと心の中で思っています。
しかし客は詳細な機能レベルの話など面倒でしたくないと思っていました。
要求を機能要件に落とし込める営業は、まさしくシェルのように両者の間を上手く取り持つ存在なのです。

え？IT企業なのに機能要件に落とし込める営業なんて自社にはいない？  
そんなバカな…IT企業の営業だぞ…  
※上記余談は皮肉を込めた笑い話であり、詳細な機能レベルの話がしたい客や要件定義の話が好きなエンジニア、機能要件に落とし込める優秀な営業も実際には沢山いらっしゃいます。戯言なので冗談として受け止めてください  

## shについて

- shについて知っている


私の周りではシェルというと7割くらいはBourne shell(sh)を指すことが多いです。  
Bourne shellは多くのUnix系シェルで広く使われていて、/bin/shはだいたいBourne Shellを指しています。
※Linux系では互換のあるbashを/bin/shにリンクしているため実際にはbashでshスクリプトを実行していたりします。
Unix系シェルの歴史については、割愛して説明を他の人に譲ることにします。
本書ではBourne Shellでサンプルを記述しますが、Unix/Linux系でよく利用されるシェルについて参考までに情報をまとめました。

Bourne Shell系

Bourne Shell
- Unix 7で採用され、多くのUnix系システムで広く使われている。
- 作者はStephen R. Bourne氏
- shスクリプトはBash等の互換シェルでもだいたい動く



## PowerShellについて

- `Windows PowerShell`と`PowerShell Core`について知っている

私の周りではPowerShellというと99%の確率でWindowsPowerShellを思い浮かべるみたいです。  
というのもPowerShellには主に2つの系統、`Windows PowerShell`と`PowerShell Core`があることがあまり知られていないのです。由々しき事態です。  
本書では明確に分けるべき箇所においては、`Windows PowerShell`と`PowerShell Core`を分けて表記します。特に明確に分けるべき必要がないと筆者が判断した箇所では`PowerShell`と表記します。  
それでは、Windows PowerShellとPowerShell Coreについて説明します。  

### Windows PowerShellについて



### PowerShell Coreについて


# シェルの基本機能とスクリプトの制御構文
- シェバンについて知っている
- パイプについて知っている
- リダイレクトについて知っている

# シェルスクリプトは読みづらい？

過去に、シェルスクリプトは可読性や保守性が悪いといった記事を見る機会がありました。
もしかしたら読者もそのような記事を見たことがあり、それが原因となってシェルを敬遠しているのなら、このテーマについて書いた意義があります。

先に述べておくとシェルスクリプトの可読性や保守性について酷評している記事は、一部の意見なのですべてを鵜呑みにしないでほしいということです。
なぜなら、それらは可読性や保守性が良くない書かれ方をしたシェルスクリプトの話か、PerlやRuby等のプログラミング言語をメインで書いているエンジニアが慣れないシェルスクリプトを保守しなければならず苦しんだ話であって、シェルの役割について言及した上で可読性や保守性の話をしていない場合が多いからです。
注意なのですが、私はそれらの記事の執筆者を貶めるつもりもありません。それどころか執筆者が体験した苦しみに共感を覚えますし、気持ちも痛いほどわかります。ここで私が伝えたいのは、読み手がミスリードをしやすいということです。

それらの記事は執筆者の置かれていた環境での話であり、記事を読むときはその前提条件を忘れてはいけません。
いわば、アンチパターンとして学んでほしいということです。


さて、話を本筋である「シェルスクリプトは読みづらい？」に戻しましょう。

この手の話は｀シェルはユーザがOSと対話するためのインタフェースである`という基本を思い出すと整理がしやすいです。

まず、シェルには苦手なことがあります。それは演算です。
shを例に、以下のようなサンプルコードを書きました。

```
//shで演算するコードを書く
```

sh単体では他のプログラミング言語と比べて演算処理の速度は遅いと感じることがあります。それに一般的な演算子が使えずプログラマからすると、ぎこちないコードにも見えます。
それを解消するためにシェル芸人(シェルのプロ)はawkを活用するはずです。

```
//shで演算するコードを書く
```

こうしてawkとshの構文が混ざったコードが生成され、awkとshに慣れていないユーザから「読みづらいコード」と評価されてしまうのです。
※英語の文章にアメリカ英語とイギリス英語が混じっているみたいな現象なので、皮肉を込めて個人的にスターゲージパイ現象と読んでいます。

この問題の本質は、shの演算処理が遅いことや演算における一般的な演算子を採用していないことではありません。shはOSとの対話インタフェースを提供するソフトウェアであって、演算が主目的のソフトウェアではないということです。

個人的な意見として、サンプルのような演算処理は演算処理を得意とするソフトウェアによって処理されるべきです。そして、シェルはそれらの処理を連結してユーザの目的を達成すべきなのです。
サンプルの事例であれば、私はPythonで演算処理の部分を書いてシェルスクリプトでインタフェース部分の処理を書きます。

```
//ここにサンプルのソースコードを書く
```

Unix哲学の教えの通り「一つのことを上手くやれ」です。


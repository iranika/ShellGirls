# 目次
1. 基礎
    1. シェルとは
        1. sh
        1. PowerShell
    1. シェルの基本機能とスクリプトの制御構文
    1. 余談：シェルスクリプトは読みづらい？
    1. 余談：shとbashどちらで書くべき？

※プロット版は自由気ままにテーマを決めて適当に書いているので、内容が目次に沿っていない場合があります。最終盤までには整合性を取ります。

# シェルとは

解説者：アキ

- シェルがOSとユーザを繋ぐインタフェースを提供するソフトウェアであるということ
- シェルがコンピューターリソースをユーザが簡単に活用できるようにするためのソフトウェアであるということ

第一章はシェルの基礎について解説します。  
ちなみに、本書でのシェルはコマンドラインシェルの中でもOSシェルと呼ばれるものを指します。
シェルという言葉は非常に概念的で曖昧なので、広義のシェルについては説明を割愛します。詳しく知りたい人は、インターネットで調べてください。  
さて、OSシェルををざっくり説明すると「OSとユーザを繋ぐためのインタフェースを提供するソフトウェア」です。
shやPowerShellはCUI(Character User Interface)によってOSとユーザを繋ぐ役割を担っています。

シェルがユーザにインタフェースだけを提供するというのは、ユーザが利用者であるということに注視すると整理しやすいです。
ユーザの主な目的はコンピューティングリソースを利用して「〇〇がしたい」といった要求を実現することです。
要求を解決するには、機能が必要になります。
ユーザの要求はOSが提供する機能(API)をいくつも組み合わせることで実現可能ですが、OS本来の仕事は「ハードウェア抽象化」「リソースの管理」「リソースの効率的な割当」です。
OSは自身が提供するAPIをわざわざユーザフレンドリにラップするだけのAPIなんて本当は内包したくないのです。

そこでシェルの登場です。
シェルはOSのAPIを組み合わせたユーザフレンドリなインタフェースを提供します。
こうしてOSは本来の仕事に専念でき、ユーザは便利なインターフェースによって要求を実現しやすくなりました。

//ここにシェルのイメージを差し込む

シェルはコンピューターリソースをユーザが簡単に活用できるようにするためのソフトウェアだと理解することが、シェルを深く知る上で重要になってくるためよく覚えておいてください。

それでは次の項で、実際にUnix/Linuxでよく使われている`Bourne shell`と少し特殊な`PowerShell`の2つについて解説します。


## shについて

- shについて知っている

Bourne shell(sh)は多くのUnix系シェルで広く使われていて、/bin/shはだいたいBourne Shellを指しています。
※Linux系では互換のあるbashを/bin/shにリンクしているため実際にはbashでshスクリプトを実行していたりします。
Unix系シェルの歴史についてはインターネット上の詳しい人に説明を譲ることにして、ここではBourne Shellについて解説します。

//Bourne shellについて詳しい説明を書く


## PowerShellについて

- `Windows PowerShell`と`PowerShell Core`について知っている

私の周りではPowerShellというと99%の確率でWindowsPowerShellを思い浮かべるようです。  
そもそもPowerShellには主に2つの系統、`Windows PowerShell`と`PowerShell Core`があることがあまり知られていない気がします。由々しき事態です。  
本書では明確に分けるべき箇所においては、`Windows PowerShell`と`PowerShell Core`を分けて表記します。特に明確に分けるべき必要がない箇所では`PowerShell`と表記します。  
PowerShellについて理解を深めるには、WindowsPowerShellの辿ってきた歴史を振り返るほうが整理しやすいので、WindowsPowerShellの歴史とPowerShell Coreの歴史について説明します。

### Windows PowerShellについて
Windows PowerShellはWindowsのコマンドプロンプト(cmd)を置き換える次世代シェルとして開発されました。MS-DOSの流れをくむcmdはWindowsのGUIベースの操作を自動化するには力不足でした。

2003年にMicrosoft社はWindowsや自社製品のシステム管理・自動化を行うための新世代シェルとして、またスクリプトとして実行可能なプログラミング言語としてMonad（後の PowerShell）を発表され、それからWindows(主に.NET Framework)と一緒に成長していきました。

Windowsのバージョンによって標準搭載の.NET Frameworkのバージョンは異なります。
WindowsPowerShellは機能の多くを.NET Frameworkに依存しているため、Windowsのバージョンが異なると標準インストールのWindowsPowerShellのバージョンも異なります。

以下は、PowerShellのバージョンと対応OSの資料です。

```
//標準バージョンの図を挿入する
https://ja.wikipedia.org/wiki/PowerShell
```

Windowsと.NET Frameworkと共に歩んできたWindowsPowerShellですが、
2016年には「.NET Core」がオープンソースプロジェクトになったことから、PowerShellもオープンソース化、並びにLinuxとOS Xへの移植が発表されました。
こうしてマルチプラットフォームのための新しいPowerShell「PowerShell Core」が生まれることになります。

### PowerShell Coreについて

PowerShell CoreはLinux/macOSを強く意識したPoweShellです。
そのため、PowerShell CoreではWindowsPowerShellからの破壊的な変更が加えられています。

変更内容
```
ここに変更内容を書く
https://docs.microsoft.com/ja-jp/powershell/scripting/whats-new/what-s-new-in-powershell-core-60?view=powershell-6#support-for-macos-and-linux
```


PowerShellの特徴は次の通りです。
- .NET 




# シェルの基本機能とスクリプトの制御構文
- シェバンについて知っている
- パイプについて知っている
- リダイレクトについて知っている

# シェルスクリプトは読みづらい？

過去に、シェルスクリプトは可読性や保守性が悪いといった記事を見る機会がありました。
もしかしたら読者もそのような記事を見たことがあり、それが原因となってシェルを敬遠しているのなら、このテーマについて書いた意義があります。

先に述べておくとシェルスクリプトの可読性や保守性について酷評している記事は、一部の意見なのですべてを鵜呑みにしないでほしいということです。
なぜなら、それらは可読性や保守性が良くない書かれ方をしたシェルスクリプトの話か、PerlやRuby等のプログラミング言語をメインで書いているエンジニアが慣れないシェルスクリプトを保守しなければならず苦しんだ話であって、シェルの役割について言及した上で可読性や保守性の話をしていない場合が多いからです。
注意なのですが、私はそれらの記事の執筆者を貶めるつもりもありません。それどころか執筆者が体験した苦しみに共感を覚えますし、気持ちも痛いほどわかります。ここで私が伝えたいのは、読み手がミスリードをしやすいということです。

それらの記事は執筆者の置かれていた環境での話であり、記事を読むときはその前提条件を忘れてはいけません。
いわば、アンチパターンとして学んでほしいということです。


さて、話を本筋である「シェルスクリプトは読みづらい？」に戻しましょう。

この手の話は｀シェルはユーザがOSと対話するためのインタフェースである`という基本を思い出すと整理がしやすいです。

まず、シェルには苦手なことがあります。それは演算です。
shを例に、以下のようなサンプルコードを書きました。

```
//shで演算するコードを書く
```

sh単体では他のプログラミング言語と比べて演算処理の速度は遅いと感じることがあります。それに一般的な演算子が使えずプログラマからすると、ぎこちないコードにも見えます。
それを解消するためにシェル芸人(シェルのプロ)はawkを活用するはずです。

```
//shで演算するコードを書く
```

こうしてawkとshの構文が混ざったコードが生成され、awkとshに慣れていないユーザから「読みづらいコード」と評価されてしまうのです。
※英語の文章にアメリカ英語とイギリス英語が混じっているみたいな現象なので、皮肉を込めて個人的にスターゲージパイ現象と読んでいます。

この問題の本質は、shの演算処理が遅いことや演算における一般的な演算子を採用していないことではありません。shはOSとの対話インタフェースを提供するソフトウェアであって、演算が主目的のソフトウェアではないということです。

個人的な意見として、サンプルのような演算処理は演算処理を得意とするソフトウェアによって処理されるべきです。そして、シェルはそれらの処理を連結してユーザの目的を達成すべきなのです。
サンプルの事例であれば、私はPythonで演算処理の部分を書いてシェルスクリプトでインタフェース部分の処理を書きます。

```
//ここにサンプルのソースコードを書く
```

Unix哲学の教えの通り「一つのことを上手くやれ」です。

